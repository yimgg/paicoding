# 项目启动问题解决记录

## 概述
本文档记录了在启动 `pai-coding-admin` 项目过程中遇到的各种问题及其解决方案。

## 问题记录

### 1. npm 网络超时错误
**问题描述**: 
```
npm ERR! code ERR_SOCKET_TIMEOUT
npm ERR! network Socket timeout
```

**解决方案**: 
- 使用淘宝镜像源：`npm config set registry https://registry.npmmirror.com`
- 增加超时时间：`npm config set timeout 60000`
- 清除缓存：`npm cache clean --force`

### 2. Husky Git hooks 安装失败
**问题描述**: 
```
husky - .git can't be found
npm ERR! command failed
npm ERR! command C:\WINDOWS\system32\cmd.exe /d /s /c husky install
```

**原因**: Git 仓库在上一层目录，husky 无法找到 `.git` 文件夹

**解决方案**: 
- 使用 `--ignore-scripts` 跳过 husky 安装：`npm install --ignore-scripts`
- 或者设置环境变量：`set HUSKY=0`

### 3. 依赖版本冲突问题
**问题描述**: 
```
npm ERR! ERESOLVE unable to resolve dependency tree
npm ERR! peer stylelint@"^15.10.1" from stylelint-less@1.0.8
```

**解决方案**: 
- 使用 `--legacy-peer-deps` 参数：`npm install --legacy-peer-deps`
- 这个参数忽略 peer dependency 版本冲突，让安装继续进行

### 4. 包版本不存在错误
**问题描述**: 
```
npm ERR! notarget No matching version found for stylelint-config-prettier@^10.0.0
```

**解决方案**: 
- 恢复 `package.json` 中的原始版本配置
- 使用 `--legacy-peer-deps` 重新安装

### 5. React 版本兼容性问题
**问题描述**: 
```
Uncaught SyntaxError: The requested module does not provide an export named 'ForwardRef'
```

**原因**: `rc-util` 包与 React 18 版本不兼容

**解决方案**: 
- 使用 `--legacy-peer-deps` 更新相关包：`npm install rc-util@latest --legacy-peer-deps`

### 6. Antd 样式按需导入插件导致页面加载卡死
**问题描述**: 
- 页面一直显示加载圈圈，无法正常显示内容
- 项目启动后浏览器控制台无错误信息

**原因**: 
- `vite-plugin-style-import` 插件与 Antd 5.x 版本不兼容
- 样式文件路径 `antd/es/${name}/style/index` 在 Antd 5.x 中不存在
- 样式加载失败导致页面卡在加载状态

**解决方案**: 
- 注释掉 `vite.config.ts` 中的 `createStyleImportPlugin` 配置
- Antd 5.x 已经内置 CSS-in-JS 功能，不需要手动按需导入样式

**相关代码**:
```typescript
// vite.config.ts 中注释掉的配置
// createStyleImportPlugin({
// 	libs: [
// 		{
// 			libraryName: "antd",
// 			esModule: true,
// 			resolveStyle: (name: any) => {
// 				return `antd/es/${name}/style/index`;
// 			}
// 		}
// 	]
// }),
```

## 最终成功的安装流程

1. **配置 npm 镜像源**：
   ```bash
   npm config set registry https://registry.npmmirror.com
   ```

2. **跳过 husky 安装**：
   ```bash
   npm install --ignore-scripts
   ```

3. **解决依赖冲突**：
   ```bash
   npm install --legacy-peer-deps
   ```

4. **启动开发服务器**：
   ```bash
   npm run dev
   ```

## 项目成功启动

- **开发服务器地址**: `http://127.0.0.1:3301/`
- **启动时间**: 约 48 秒
- **状态**: 正常运行，只有一些非关键的警告信息

## 注意事项

1. **Windows 系统命令差异**：
   - 使用 `rmdir /s /q` 替代 `rm -rf`
   - 使用 `del` 替代 `rm`

2. **依赖冲突处理**：
   - 优先使用 `--legacy-peer-deps` 参数
   - 避免手动修改版本号，容易引入新问题

3. **Git 仓库位置**：
   - 项目 Git 仓库在根目录，子目录中的 husky 需要特殊配置

## 总结

通过以上步骤，成功解决了项目启动过程中的各种依赖和配置问题。主要经验是：
- 使用国内镜像源提高下载速度
- 合理使用 `--legacy-peer-deps` 解决版本冲突
- 跳过不必要的工具安装（如 husky）来简化启动流程
- Antd 5.x 已经内置 CSS-in-JS 功能，不需要手动按需导入样式 